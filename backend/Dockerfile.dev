# Dockerfile للتطوير
FROM node:20-alpine

# تثبيت الحزم المطلوبة
RUN apk add --no-cache libc6-compat curl

WORKDIR /app

# نسخ ملفات التبعيات
COPY package*.json ./
COPY prisma ./prisma/

# تثبيت جميع التبعيات (بما في ذلك dev dependencies)
RUN npm config set registry https://registry.npmjs.org/ && \
    npm config set fetch-retry-mintimeout 20000 && \
    npm config set fetch-retry-maxtimeout 120000 && \
    npm config set fetch-retries 5 && \
    npm config set fetch-timeout 300000 && \
    npm config set maxsockets 15 && \
    npm cache clean --force && \
    npm install --legacy-peer-deps --no-audit --no-fund --verbose

# نسخ الكود المصدري
COPY . .

# فتح المنفذ
EXPOSE 3000

# متغيرات البيئة
ENV NODE_ENV=development
ENV PORT=3000

# تشغيل التطبيق في وضع التطوير
CMD ["npm", "run", "start:dev"]
