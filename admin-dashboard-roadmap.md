## خارطة طريق لإكمال لوحة تحكم الأدمن وتغطية النواقص

### الهدف
إغلاق الفجوة بين واجهة الأدمن الحالية والـ Backend/Website عبر خطة مراحل عملية، تشمل مواءمة خدمات API، بناء جداول وإجراءات، وإضافة صفحات ناقصة وفق وحدات الباك إند الفعلية.

### ملخص النواقص الحالية
- عدم تطابق مسارات خدمات الواجهة مع الـ API الفعلي لبعض الموارد (Users, Doctors, Clinics, Appointments, Consultations, Specialties).
- صفحات رئيسية Placeholder بدون جداول أو نماذج (Users, Doctors, Clinics, Appointments, Consultations, Specialties, WaitingList, Reports, Settings).
- وحدات موجودة في الباك إند وغير مغطاة UI: Waiting List, Departments, Notifications, Messages, Activity Log, File Upload, Agora.
- إحصاءات الداشبورد معروضة جزئياً دون رسوم بيانية فعلية.
- إعداد CORS لا يتضمن منفذ Vite الافتراضي (5173) ما قد يمنع الكوكي `admin_token` أثناء التطوير.

### مبادئ التنفيذ
- محاذاة الخدمات مع مسارات الـ API الفعلية كما هي في الباك إند، والاعتماد على `/admin/stats/*` لكل الإحصاءات.
- استخدام React Query، جداول قابلة للترشيح والترقيم، ونماذج تحقق عبر Zod/React Hook Form.
- اعتماد ملفات UI الحالية وتوسعتها بدل استحداث مكونات موازية.

---

## المراحل

### المرحلة 0: تهيئة أساسية وسلامة الاتصال (نصف يوم)
- تحديث إعداد CORS في الباك إند لإضافة `http://localhost:5173` و`http://127.0.0.1:5173`.
- التأكد من ثوابت `API_URL` و`API_BASE_URL` في `admin-dashboard` تعمل مع الكوكيز (`credentials: include`).
- إضافة خدمة `waiting-list.service.ts` وربطها بـ `/waiting-list` (get/add/notify/remove/updatePriority).

معايير القبول:
- تسجيل دخول الأدمن يعمل من الواجهة المحلية ويحفظ الكوكي.
- استدعاء بسيط لـ `waiting-list` ينجح ويعيد بيانات (حتى لو لم تُعرض بعد).

### المرحلة 1: مواءمة الخدمات مع API (يوم)
- Users: إزالة مسارات غير مدعومة (patients/doctors/admins/search/stats/bulk/export). استخدام CRUD الأساسي فقط.
- Doctors: استخدام `/doctors/:id/availability`، وجداول عبر `/doctors/:id/schedules`، وإزالة `search/stats` ومسارات مستقلة لـ `schedules`.
- Clinics: استبدال تفعيل الحالة بـ `/clinics/:id/activate`، وإزالة `search/stats`.
- Appointments: اعتماد إجراءات `cancel/confirm/complete` ومسار `available-slots/:doctorId`، وإزالة `status/search/stats` والمسارات المشتقة.
- Consultations: اعتماد `start/end/cancel` ورسائل `/consultations/:id/messages`، وإزالة `search/stats` ومسارات doctor/patient.
- Admin: الإبقاء فقط على `/admin/stats/*` وإزالة CRUD الوهمي على `/admins`.

معايير القبول:
- كل خدمات الواجهة تستجيب بنجاح لمسارات الباك إند الحالية بدون أخطاء 404/405.

### المرحلة 2: جداول أساسية ونماذج (2 أيام)
- Users: جدول مع ترقيم/ترشيح أساسي، نماذج إنشاء/تعديل/حذف.
- Clinics: جدول + نموذج، زر تفعيل/تعطيل عبر `/activate`.
- Doctors: جدول + نموذج، عرض التخصصات المرتبطة.

معايير القبول:
- يمكن إضافة/تعديل/حذف لكل من المستخدم والعيادة والطبيب، مع تحديث بصري فوري.

### المرحلة 3: إدارة جداول الأطباء وساعات العمل (يوم)
- تبويب داخل صفحة Doctor لإدارة `schedules` (عرض/إضافة/حذف) عبر `/doctors/:id/schedules`.
- عرض قائمة الأطباء المتاحين بـ `/doctors/available` اختيارياً لمرجع المواعيد.

معايير القبول:
- يمكن إضافة فترة دوام لطبيب وتظهر فوراً في القائمة.

### المرحلة 4: إدارة المواعيد (2 أيام)
- جدول المواعيد بترشيح حسب (status, doctorId, patientId, clinicId, date) عبر `query` على `/appointments`.
- إجراءات سريعة: Confirm/Cancel/Complete حسب أدوار الأدمن/الطبيب.
- عرض `available-slots` للطبيب عند إنشاء موعد جديد.

معايير القبول:
- إنشاء موعد جديد باستخدام فتحات متاحة، وتغيير حالته عبر الأزرار، وتحديث الجدول.

### المرحلة 5: إدارة الاستشارات والرسائل (2 أيام)
- جدول الاستشارات مع ترشيح (patientId, doctorId) عبر `query`.
- إجراءات: Start/End/Cancel.
- تبويب رسائل لكل استشارة: عرض + إرسال رسالة نصية، ودعم `fileUrl` لاحقاً.

معايير القبول:
- بدء/إنهاء استشارة وتحديث الحالة، والقدرة على إرسال رسالة تظهر بالقائمة.

### المرحلة 6: قوائم الانتظار (1 يوم)
- صفحة WaitingList: جدول حسب الطبيب، إضافة مريض للقائمة، تحديث أولوية، إزالة من القائمة.
- زر "إشعار التالي" عبر `/waiting-list/notify-next` مع تاريخ/وقت.

معايير القبول:
- إدارة كاملة لقائمة الانتظار (عرض/إضافة/تعديل أولوية/إزالة/إشعار).

### المرحلة 7: التخصصات والأقسام (1 يوم)
- Specialties: جدول CRUD عبر `/specialties` الحالية.
- Departments: صفحة بسيطة CRUD إذا كان المسار `/departments` جاهز (موجود في الباك إند). 

معايير القبول:
- إدارة التخصصات فعالة. في حال تفعيل الأقسام: إدارة الأقسام فعالة أيضاً.

### المرحلة 8: لوحة الداشبورد والرسوم (1 يوم)
- ربط الرسوم البيانية الفعلية لبيانات: Users Growth، Appointments Stats، Overview.
- بطاقات الإحصاءات من `/admin/stats/*`.

معايير القبول:
- تظهر رسوم فعلية مع أساطير ومحاور صحيحة، وتُحدّث بالترشيح الزمني عند الحاجة.

### المرحلة 9: الإشعارات وسجل النشاط والملفات (اختياري مرحلياً، 2 أيام)
- Notifications: صفحة قراءة/وسم كمقروء إن توفرت خدمات كاملة.
- Activity Log: عرض أحدث الأحداث.
- File Upload: دمج رفع ملفات في الاستشارات/الأطباء إن كانت واجهات الرفع جاهزة.

معايير القبول:
- عرض قائمة إشعارات/نشاط من الـ API. رفع ملف واحد بنجاح مرتبط بسياق واضح (اختياري).

### المرحلة 10: الاختبارات والتوثيق (1 يوم)
- اختبارات تدفق المصادقة وتدفقات CRUD الحرجة.
- توثيق الاستخدام للأدمن: دليل مختصر لكل صفحة.

معايير القبول:
- نجاح سيناريوهات أساسية دون أخطاء حرجة، ووجود ملف README مختصر للاستخدام.

---

## قائمة المهام التفصيلية حسب الصفحة

### Users
- جدول بعمود: الاسم/البريد/الدور/الحالة/تاريخ الإنشاء.
- نماذج إنشاء/تعديل مع تحقق.
- حذف مع تأكيد.

### Doctors
- جدول حقول أساسية + التخصصات.
- نموذج إنشاء/تعديل.
- تبويب Schedules (قائمة الفترات + نموذج إضافة فترة + حذف).

### Clinics
- جدول حقول أساسية.
- نموذج إنشاء/تعديل.
- زر تفعيل/تعطيل عبر `/activate`.

### Appointments
- جدول مع ترشيح متعدد وPagination.
- نموذج إنشاء: اختيار طبيب وتاريخ لعرض `available-slots` ثم الحجز.
- أزرار Confirm/Cancel/Complete حسب الصلاحية.

### Consultations
- جدول مع ترشيح.
- أزرار Start/End/Cancel.
- تبويب Messages: عرض/إرسال.

### Waiting List
- جدول حسب الطبيب.
- إضافة إلى القائمة، تعديل أولوية، إزالة، إشعار التالي.

### Specialties
- جدول CRUD.

### Departments (إن لزم)
- جدول CRUD بسيط.

### Dashboard
- ربط البطاقات والرسوم من `/admin/stats/*`.

---

## اعتبارات تقنية
- المصادقة: استخدام `apiFetch` مع `credentials: include`، وتخزين نسخة خفيفة من معلومات الأدمن محلياً.
- الصلاحيات: إبراز الإجراءات المسموح بها للأدمن فقط داخل الواجهة.
- الأخطاء: توست/بانر موحّد للأخطاء مع رسائل ودية.
- الأداء: إعداد `staleTime` و`queryKey` مناسبة، وتفعيل التحميل الكسول للصفحات الثقيلة.

## المخاطر وخطط التخفيف
- اختلاف المخططات: اختبار كل Endpoint على Postman قبل ربط الواجهة.
- CORS/كوكي: توسيع قائمة `origin` محلياً، وضبط `sameSite`/`secure` عبر البيئات.
- تغيّر المتطلبات: إبقاء الخدمات منفصلة وقابلة للتبديل بسهولة.

## التسليمات
- واجهة إدارة كاملة للموارد المذكورة مع إجراءاتها.
- خدمات API متوافقة مع الباك إند الحالي.
- رسوم ولوحة تحكم مرتبطة ببيانات فعلية.
- وثيقة تشغيل مختصرة وسيناريوهات اختبار أساسية.


